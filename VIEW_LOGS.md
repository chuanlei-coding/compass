# 查看加载项运行日志指南

## 为什么在浏览器中显示"不支持的平台"？

当您在浏览器中直接打开 `https://localhost:3000/taskpane.html` 时，会看到"不支持的平台"错误，这是正常的。因为：

1. **Office.js不可用** - 浏览器中没有Office.js环境
2. **平台检测失败** - 无法检测到Word或WPS环境
3. **这是预期行为** - 插件必须在Word/WPS中运行

## 如何在Word/WPS中查看日志

### 方法1：使用开发者工具（推荐）

#### Microsoft Word

1. **打开Word并加载插件**
   - 确保插件已加载并显示侧边栏

2. **打开开发者工具**
   - 按 **F12** 键
   - 或者右键点击插件侧边栏，选择"检查"或"Inspect"
   - 或者：**文件** > **选项** > **高级** > 勾选"显示加载项用户界面错误"

3. **查看日志**
   - 切换到 **Console**（控制台）标签页
   - 所有日志都会显示在这里

#### WPS Office

1. **打开WPS Writer并加载插件**
   - 确保插件已加载

2. **打开开发者工具**
   - 按 **F12** 键
   - 或者右键点击插件区域，选择"检查元素"

3. **查看日志**
   - 切换到 **Console**（控制台）标签页

### 方法2：通过Word选项启用错误显示

1. 打开Word
2. 转到 **文件** > **选项**
3. 选择 **高级**
4. 在"常规"部分，勾选 **显示加载项用户界面错误**
5. 点击 **确定**
6. 错误信息会以弹窗形式显示

### 方法3：查看网络请求

1. 打开开发者工具（F12）
2. 切换到 **Network**（网络）标签页
3. 发送一条消息
4. 查看：
   - 对 `taskpane.html` 的请求
   - 对 `taskpane.js` 的请求
   - 对API服务的请求（如果配置了API）

## 日志类型说明

### 1. 平台检测日志

```
检测到平台: Microsoft Word
运行平台: Microsoft Word
```

### 2. API调用日志

**成功时：**
```
📄 获取文档内容...
文档内容长度: 123
🤖 调用AI服务处理请求: 你好
🚀 开始调用AI API... { apiUrl: '...', model: '...', hasApiKey: true }
📡 发送API请求到: https://api.openai.com/v1/chat/completions
API响应状态: 200 OK
✅ AI API调用成功
✏️ 执行编辑操作: 1 个操作
```

**失败时：**
```
⚠️ API密钥未配置，使用模拟响应
或
❌ AI服务调用失败: Error message
⚠️ 降级到模拟响应
```

### 3. 错误日志

```
❌ 错误类型: 错误信息
错误详情: ...
```

## 常见日志信息

### 平台检测相关

- `检测到平台: Microsoft Word` - 成功检测到Word
- `检测到平台: WPS Office` - 成功检测到WPS
- `检测到平台: 未知平台` - 平台检测失败
- `不支持的Office应用: ...` - 不支持的应用类型

### API调用相关

- `⚠️ API密钥未配置` - 需要配置API密钥
- `🚀 开始调用AI API...` - 开始API调用
- `📡 发送API请求到: ...` - 正在发送请求
- `API响应状态: 200 OK` - 请求成功
- `API响应状态: 401 Unauthorized` - 认证失败（API密钥错误）
- `API响应状态: 404 Not Found` - API URL错误
- `❌ AI服务调用失败` - API调用失败

### 文档操作相关

- `📄 获取文档内容...` - 正在读取文档
- `文档内容长度: XXX` - 文档内容长度
- `✏️ 执行编辑操作: X 个操作` - 正在执行编辑
- `⚠️ 没有编辑操作需要执行` - 没有操作

## 调试技巧

### 1. 过滤日志

在控制台中使用过滤器：
- 输入 `API` 只显示API相关日志
- 输入 `错误` 或 `Error` 只显示错误
- 输入 `⚠️` 只显示警告

### 2. 清除日志

- 点击控制台左上角的清除按钮（🚫）
- 或按 `Ctrl+L` (Windows) / `Cmd+K` (Mac)

### 3. 保存日志

1. 右键点击控制台
2. 选择"另存为..."
3. 保存日志文件

### 4. 实时监控

保持开发者工具打开，所有操作都会实时显示日志。

## 检查配置

在控制台中输入以下命令检查配置：

```javascript
// 检查API配置
console.log({
  apiKey: localStorage.getItem('ai_api_key') ? '已配置' : '未配置',
  apiUrl: localStorage.getItem('ai_api_url'),
  modelName: localStorage.getItem('ai_model_name')
});

// 检查平台
console.log('平台:', typeof Office !== 'undefined' ? 'Office.js可用' : 'Office.js不可用');
console.log('Word API:', typeof Word !== 'undefined' ? '可用' : '不可用');
```

## 常见问题排查

### 问题1：看不到控制台

**解决方案：**
- 确保按F12打开了开发者工具
- 检查是否在正确的标签页（Console）
- 尝试右键点击插件区域选择"检查"

### 问题2：没有日志输出

**可能原因：**
- 插件未正确加载
- 代码未执行
- 日志被过滤

**解决方案：**
- 检查插件是否已加载
- 清除过滤器
- 刷新插件（关闭并重新打开侧边栏）

### 问题3：日志太多

**解决方案：**
- 使用过滤器只查看需要的日志
- 清除不需要的日志
- 关注带有图标前缀的日志（📄、🤖、🚀等）

## 获取帮助

如果遇到问题，请：

1. **复制日志信息**
   - 选中相关日志
   - 右键复制
   - 或使用控制台的"复制"功能

2. **截图**
   - 截图控制台显示的错误
   - 截图Network标签页的请求

3. **提交Issue**
   - 包含日志信息
   - 包含错误截图
   - 说明操作步骤

## 总结

**查看日志的正确方法：**

1. ✅ 在Word/WPS中加载插件
2. ✅ 按F12打开开发者工具
3. ✅ 切换到Console标签页
4. ✅ 执行操作并查看日志

**不要在浏览器中直接打开taskpane.html**，因为那里没有Office.js环境，无法正常工作。

