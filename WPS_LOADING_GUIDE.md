# WPS Office 加载插件详细指南

本指南将详细说明如何在WPS Office中加载Word/WPS AI助手插件。

## 前置条件

1. **WPS版本要求**
   - WPS Office 2019或更高版本
   - 需要支持Office.js API的版本
   - 建议使用最新版本的WPS Office

2. **开发服务器**
   - 确保开发服务器正在运行：`npm run dev`
   - 服务器地址：`https://localhost:3000`
   - 确保使用HTTPS（WPS要求）

3. **证书配置**
   - 如果使用自签名证书，需要在WPS中接受证书
   - 运行：`npm run setup-certs` 生成证书

## 方法一：通过WPS加载项管理器（推荐）

### 步骤1：打开WPS Writer

1. 启动WPS Office
2. 打开WPS Writer（文字处理）

### 步骤2：启用开发工具选项卡

如果看不到"开发工具"选项卡：

1. 点击 **文件** > **选项**
2. 在左侧菜单中选择 **自定义功能区**
3. 在右侧的"主选项卡"列表中，勾选 **开发工具**
4. 点击 **确定**

### 步骤3：加载插件

1. 点击顶部菜单栏的 **开发工具** 选项卡
2. 在"开发工具"功能区中，找到 **加载项** 按钮
3. 点击 **加载项** > **添加加载项**（或 **插件管理器**）
4. 在弹出的对话框中：
   - 点击 **添加** 或 **浏览**
   - 浏览到项目根目录
   - 选择 `manifest.xml` 文件
   - 点击 **打开**
5. 插件将出现在加载项列表中
6. 确保插件旁边的复选框已勾选（启用状态）
7. 点击 **确定** 或 **应用**

### 步骤4：使用插件

1. 插件加载后，在 **开发工具** 选项卡中会看到 **AI助手** 组
2. 点击 **打开AI助手** 按钮
3. 侧边栏将打开，显示对话窗口

## 方法二：通过侧载方式（开发环境推荐）

### 步骤1：配置受信任目录

1. 打开WPS Writer
2. 点击 **文件** > **选项**
3. 在左侧菜单中选择 **信任中心**
4. 点击 **信任中心设置** 按钮
5. 在左侧菜单中选择 **受信任的加载项目录**
6. 点击 **添加新位置**
7. 浏览并选择项目根目录（包含manifest.xml的文件夹）
8. 点击 **确定**
9. 在信任中心设置中点击 **确定**
10. 在选项中点击 **确定**

### 步骤2：重启WPS

1. 完全关闭WPS Office
2. 重新打开WPS Writer

### 步骤3：加载插件

1. 点击 **开发工具** 选项卡
2. 点击 **加载项** > **插件管理器**
3. 在"共享文件夹"或"本地加载项"中找到插件
4. 勾选插件旁边的复选框
5. 点击 **确定**

## 方法三：通过WPS插件菜单（如果可用）

某些WPS版本可能提供插件菜单：

1. 打开WPS Writer
2. 点击顶部菜单栏的 **插件** 或 **加载项** 菜单
3. 选择 **加载项管理器** 或 **插件管理器**
4. 按照方法一的步骤3继续操作

## 验证插件是否加载成功

### 检查方法1：功能区检查

1. 查看 **开发工具** 选项卡
2. 应该能看到 **AI助手** 组和 **打开AI助手** 按钮

### 检查方法2：侧边栏检查

1. 点击 **打开AI助手** 按钮
2. 右侧应该出现侧边栏
3. 侧边栏标题应显示 "Word/WPS AI助手"
4. 标题栏右侧应显示当前平台（Microsoft Word 或 WPS Office）

### 检查方法3：开发者工具

1. 在WPS中按 **F12** 打开开发者工具
2. 查看控制台是否有错误信息
3. 查看网络请求是否成功加载资源

## 常见问题解决

### 问题1：找不到"开发工具"选项卡

**解决方案：**
- 按照方法一的步骤2启用开发工具选项卡
- 如果仍然找不到，可能是WPS版本不支持，请升级到WPS Office 2019+

### 问题2：插件加载失败

**可能原因和解决方案：**

1. **服务器未运行**
   - 确保运行了 `npm run dev`
   - 检查服务器是否在 `https://localhost:3000` 运行

2. **证书问题**
   - 在浏览器中访问 `https://localhost:3000` 并接受证书
   - 重新生成证书：`npm run setup-certs`

3. **manifest.xml路径错误**
   - 确保manifest.xml中的URL指向正确的服务器地址
   - 检查 `https://localhost:3000/taskpane.html` 是否可以访问

4. **WPS版本不支持**
   - 确保使用WPS Office 2019或更高版本
   - 检查WPS是否支持Office.js API

### 问题3：插件加载但无法使用

**检查步骤：**

1. 打开开发者工具（F12）
2. 查看控制台错误信息
3. 检查网络请求是否成功
4. 查看是否有API调用错误

### 问题4：侧边栏显示但不工作

**可能原因：**

1. **Office.js未加载**
   - 检查网络请求中office.js是否成功加载
   - 查看控制台是否有Office.js相关错误

2. **API不兼容**
   - 某些API可能在WPS中不完全支持
   - 查看控制台错误信息，可能需要调整代码

## 调试技巧

### 1. 使用开发者工具

- 按 **F12** 打开开发者工具
- 查看 **Console** 标签页的错误信息
- 查看 **Network** 标签页的网络请求
- 查看 **Elements** 标签页的DOM结构

### 2. 检查manifest.xml

确保manifest.xml中的URL正确：
```xml
<SourceLocation DefaultValue="https://localhost:3000/taskpane.html"/>
```

### 3. 测试服务器连接

在浏览器中直接访问：
- `https://localhost:3000/taskpane.html` - 应该能看到插件界面
- `https://localhost:3000/taskpane.js` - 应该能下载JavaScript文件

### 4. 查看WPS日志

某些WPS版本可能提供日志文件，查看日志可以帮助诊断问题。

## 不同WPS版本的差异

### WPS Office 2019
- 支持Office.js API
- 通过开发工具选项卡加载插件
- 可能需要手动启用开发工具

### WPS Office 2021
- 更好的Office.js支持
- 可能有专门的插件管理器
- 界面可能略有不同

### WPS Office 2023+
- 最新的Office.js API支持
- 可能有改进的插件管理界面
- 更好的错误提示

## 替代方案

如果WPS不支持Office.js插件，可以考虑：

1. **使用WPS宏**
   - 使用VBA或WPS宏语言
   - 需要重新开发部分功能

2. **使用WPS API**
   - 如果WPS提供自己的API
   - 需要修改代码以适配WPS API

3. **使用Web版本**
   - 如果WPS有Web版本
   - 可能支持Office.js插件

## 获取帮助

如果遇到问题：

1. 查看 [WPS_SUPPORT.md](WPS_SUPPORT.md) 了解兼容性信息
2. 查看 [TROUBLESHOOTING.md](TROUBLESHOOTING.md) 了解故障排除
3. 提交Issue到项目仓库，包含：
   - WPS版本号
   - 错误信息截图
   - 控制台错误日志
   - 操作步骤

## 总结

WPS Office加载插件的主要步骤：

1. ✅ 确保WPS版本支持（2019+）
2. ✅ 启动开发服务器
3. ✅ 启用开发工具选项卡
4. ✅ 通过加载项管理器添加manifest.xml
5. ✅ 启用插件
6. ✅ 使用插件功能

如果按照以上步骤操作仍有问题，请参考故障排除部分或提交Issue。

